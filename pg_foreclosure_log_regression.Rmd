---
title: "pg_logistic_regression"
author: "Paul Kiefer"
date: "2024-03-29"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This is the markdown for our attempts to predict the likelihood of foreclosure at the tract level using logistic regression.

## Data Setup

Load libraries.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(scipen=999)
##install.packages("ggrepel")
##install.packages('ggthemes')
##install.packages('aod')
##install.packages('caret')
##install.packages("MASS")
##install.packages("mice")

library(tidyverse)
#Necessary for date parsing.
library(lubridate)
#Necessary for column name cleaning.
library(janitor)
#Eventually necessary for visualization
library(ggthemes)
#Necessary for Census API calls.
library(tidycensus)
#Eventually necessary for visualizations.
library(ggplot2)
#Potentially necessary for cleaning.
library(ggrepel)
#Eventually necessary for visualizations.
library(tigris)
#Simple features.
library(sf)
#Eventually necessary for mapping.
library(ggmap)
#needed for logistic regression
library(aod)
#Needed for splitting into training and test datasets
library(caret)
#Needed for ordinal logistic regression
library(MASS)
#Needed for imputing missing values (using predictive mean matching)
library(mice)
```

We read in our cleaned and combined dataset.

```{r}
# Read in the initial dataset, setting a guess_max limit to improve the accuracy of the data types assigned to each column.
pg_foreclosures_per_tract <- read_csv("datasets/pg_foreclosures_per_tract.csv", guess_max = 173)
```

```{r}
# Create a new column "foreclosure_quantile" based on quantiles of foreclosure_pc_2020
pg_foreclosures_per_tract_log_reg <- pg_foreclosures_per_tract %>%
  mutate(foreclosure_quantile = ntile(foreclosure_pc_2020, 5))
```


```{r}
# Set the seed for reproducibility
set.seed(123)

# Split the data into 70% training and 30% test sets
train_index <- createDataPartition(pg_foreclosures_per_tract_log_reg$foreclosure_quantile, p = 0.7, list = FALSE)

# Create training and test sets
train_data <- pg_foreclosures_per_tract_log_reg[train_index, ]
test_data <- pg_foreclosures_per_tract_log_reg[-train_index, ]

# Check the dimensions of training and test sets
dim(train_data)
dim(test_data)
```

```{r}
# Convert foreclosure_quantile to factor
train_data$foreclosure_quantile <- factor(train_data$foreclosure_quantile)

# Impute missing values in the dataset
imputed_data <- mice(train_data, m = 5, method = "pmm")

# Use the imputed dataset for model fitting
model <- polr(foreclosure_quantile ~ medincome_change_2010_2020 + tract_medincome_2020 + tract_medage_2020 + nhwhite_change_2010_2020 + mortgage_change_2010_2020 + mortgaged_2020 + pct_built_pre_1960 + great_recession_foreclosures, data = imputed_data, Hess = TRUE)

# Summarize the model
summary(model)
```

